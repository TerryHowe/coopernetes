---
- name: Check for mounted boot disk
  shell: "lsblk -o PATH,MOUNTPOINT | grep /media/pi/boot| cut -f1 -d' '"
  register: boot_disk
  changed_when: False

- name: Unmount boot
  ansible.posix.mount:
    path: /media/pi/boot
    state: unmounted
  when: boot_disk.stdout != ""

- name: Check for mounted root disk
  shell: "lsblk -o PATH,MOUNTPOINT | grep /media/pi/root| cut -f1 -d' '"
  register: root_disk
  changed_when: False

- name: Unmount root
  ansible.posix.mount:
    path: /media/pi/root
    state: unmounted
  when: root_disk.stdout != ""

- name: "Create Downloads"
  file:
    path: ./Downloads
    state: directory
    mode: 0755

- name: "Download image {{ download['arm64'].url }}/{{ download['arm64'].image }}"
  get_url:
    url: "{{ download['arm64'].url }}/{{ download['arm64'].image }}"
    dest: "./Downloads/{{ download['arm64'].image }}"

- name: "Download image {{ download['arm32'].url }}/{{ download['arm32'].image }}"
  get_url:
    url: "{{ download['arm32'].url }}/{{ download['arm32'].image }}"
    dest: "./Downloads/{{ download['arm32'].image }}"

#- name: Get list of mounts
#  command: diskutil list
#  register: mounts
#  become: yes
